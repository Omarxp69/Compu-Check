<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="stylesheet" href="../static/css/index_style.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compuchek - Gestionar Reportes</title>

</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="profile">
        {% if user_profile_pic %}
          <img src="{{ url_for('static', filename=user_profile_pic) }}" alt="Foto de perfil" class="profile-img">
        {% else %}
          <div class="profile-img">ğŸ‘¤</div>
        {% endif %}
        <span>{{ user_name }}</span>
      </div>

      <h2>Compuchek</h2>
      <ul>
        <li><a href="/">ğŸ  Inicio</a></li>
        {% if user_role == 'admin' %}
          <li><a href="/Gestionar_Usuarios">ğŸ‘¥ Gestionar Usuarios</a></li>
          <li><a href="/Salas">ğŸ›‹ï¸ Salas</a></li>
          <li><a href="/Gestionar_Salas">ğŸ› ï¸ Gestionar Salas</a></li>
          <li><a href="/Computadoras">ğŸ’»Computadoras</a></li>
          <li><a href="/Gestionar_Computadoras">ğŸ› ï¸ Gestionar Computadoras</a></li>
          <li><a href="/Gestionar_perifericos">ğŸ› ï¸ Gestionar Perifericos</a></li>
          <li><a href="/Permisos_Usuarios">ğŸ”‘ Permisos Usuarios</a></li>
          <li><a href="/Gestionar_Permisos">ğŸ› ï¸ Gestionar Permisos</a></li>
          <li><a href="/reports">ğŸ“Š Reportes</a></li>
          <li class="active"><a href="/Gestionar_reportes">ğŸ› ï¸ Gestionar Reportes</a></li>
        {% elif user_role == 'moderador' %}

          <li><a href="/Gestionar_Usuarios">ğŸ‘¥ Gestionar Usuarios</a></li>
          <li><a href="/Gestionar_Salas">ğŸ› ï¸ Gestionar Salas</a></li>
          <li><a href="/Permisos_Usuarios">ğŸ”‘ Permisos Usuarios</a></li>
          <li><a href="/Gestionar_Permisos">ğŸ› ï¸ Gestionar Permisos</a></li>
          <li><a href="/reports">ğŸ“Š Reportes</a></li>
          <li class="active"><a href="/Gestionar_reportes">ğŸ› ï¸ Gestionar Reportes</a></li>


        {% elif user_role == 'user' %}
          <li><a href="/reports">ğŸ“Š Reportes</a></li>
        {% endif %}
        <li><a href="/profile">âœï¸ Editar Perfil</a></li>
        <li><a href="/logout">ğŸšª Cerrar sesiÃ³n</a></li>
      </ul>
    </aside>

    <!-- Main -->
    <main class="dashboard-main">
      <header>
        <h1 class="titulo_w">Gestionar Reportes</h1>
      </header>
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="flash-messages">
            {% for message in messages %}
              <div class="flash-message">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
        <form method="POST" action="{{ url_for('eliminar_reportes') }}" class="form-actualizar" id="formEliminarReporte">
          <fieldset>
            <legend>Eliminar Reporte</legend>

            <!-- ID oculto -->
            <input type="hidden" id="reporte_id" name="id_reporte">

            <div>
              <label>ID Reporte:</label>
              <input type="text" id="edit_id_reporte" disabled>
            </div>

            <div>
              <label>Usuario:</label>
              <input type="text" id="edit_usuario" disabled>
            </div>

            <div>
              <label>SalÃ³n:</label>
              <input type="text" id="edit_salon" disabled>
            </div>

            <div>
              <label>Computadora:</label>
              <input type="text" id="edit_computadora" disabled>
            </div>

            <div>
              <label>Estado del Reporte:</label>
              <input type="text" id="edit_estado_reporte" disabled>
            </div>

            <div>
            </div>

            <div>
              <label>Comentarios:</label>
              <textarea id="edit_comentarios" rows="3" disabled></textarea>
            </div>

            <div>
              <label>Confirmar ContraseÃ±a de Admin:</label>
              <input type="password" name="admin_password" placeholder="Ingresa tu contraseÃ±a" required>
            </div>

            <button type="submit" class="btn-eliminar" style="background:red; display:flex; gap:10px; margin-top:10px; justify-content: center;">Eliminar Reporte</button>
          </fieldset>
        </form>
      <form method="get" action="{{ url_for('gestionar_reportes') }}" class="form-busqueda">
        <fieldset>
          <legend>Buscar Reporte</legend>

          <label for="buscar">Buscar:</label>
          <input 
            type="text" 
            id="buscar"
            name="search" 
            placeholder="Buscar por usuario, salÃ³n, matrÃ­cula o comentario"
            value="{{ search }}"
          >

          <label for="filtro_columna">Ordenar por:</label>
          <select name="filtro_columna" id="filtro_columna">
            <option value="id_reporte" {% if filtro_columna == 'id_reporte' %}selected{% endif %}>ID Reporte</option>
            <option value="nombre_usuario" {% if filtro_columna == 'nombre_usuario' %}selected{% endif %}>Nombre del Usuario</option>
            <option value="nombre_salon" {% if filtro_columna == 'nombre_salon' %}selected{% endif %}>Nombre del SalÃ³n</option>
            <option value="matricula" {% if filtro_columna == 'matricula' %}selected{% endif %}>MatrÃ­cula de la Computadora</option>
            <option value="estado_reporte" {% if filtro_columna == 'estado_reporte' %}selected{% endif %}>Estado del Reporte</option>
            <option value="fecha_reporte" {% if filtro_columna == 'fecha_reporte' %}selected{% endif %}>Fecha del Reporte</option>
          </select>

          <select name="orden" id="orden">
            <option value="ASC" {% if orden == 'ASC' %}selected{% endif %}>Ascendente</option>
            <option value="DESC" {% if orden == 'DESC' %}selected{% endif %}>Descendente</option>
          </select>

          <button type="submit">Aplicar</button>
        </fieldset>
      </form>



      <table>
        <thead>
          <tr>
            <th>ID Reporte</th>
            <th>Usuario</th>
            <th>SalÃ³n</th>
            <th>Computadora</th>
            <th>ID Mouse</th>
            <th>Estado Mouse</th>
            <th>Score Mouse</th>
            <th>ID Teclado</th>
            <th>Estado Teclado</th>
            <th>Score Teclado</th>
            <th>ID Pantalla</th>
            <th>Estado Pantalla</th>
            <th>Score Pantalla</th>
            <th>Comentarios</th>
            <th>Estado del Reporte</th>
            <th>Fecha del Reporte</th>
          </tr>
        </thead>
        <tbody>
          {% for r in reportes %}
          <tr class="reporte-row"
              data-id="{{ r.id_reporte }}"
              data-usuario="{{ r.nombre_usuario|default('â€”') }}"
              data-salon="{{ r.nombre_salon|default('â€”') }}"
              data-computadora="{{ r.matricula_computadora|default('â€”') }}"
              data-id-mouse="{{ r.id_mouse|default('â€”') }}"
              data-id-teclado="{{ r.id_teclado|default('â€”') }}"
              data-id-pantalla="{{ r.id_pantalla|default('â€”') }}"
              data-estado="{{ r.estado_reporte|default('â€”') }}"
              data-comentarios="{{ r.comentarios|default('Sin comentarios') }}">
              
            <td>{{ r.id_reporte }}</td>
            <td>{{ r.nombre_usuario|default('â€”') }}</td>
            <td>{{ r.nombre_salon|default('â€”') }}</td>
            <td>{{ r.matricula_computadora|default('â€”') }}</td>

            <td>{{ r.id_mouse|default('â€”') }}</td>
            <td>{{ r.estado_mouse|default('No registrado') }}</td>
            <td>{{ r.score_mouse|default('0') }}</td>

            <td>{{ r.id_teclado|default('â€”') }}</td>
            <td>{{ r.estado_teclado|default('No registrado') }}</td>
            <td>{{ r.score_teclado|default('0') }}</td>

            <td>{{ r.id_pantalla|default('â€”') }}</td>
            <td>{{ r.estado_pantalla|default('No registrado') }}</td>
            <td>{{ r.score_pantalla|default('0') }}</td>

            <td>{{ r.comentarios|default('Sin comentarios') }}</td>
            <td>
              {% if r.estado_reporte == 'pendiente' %}
                Pendiente
              {% elif r.estado_reporte == 'en revisiÃ³n' %}
                En RevisiÃ³n
              {% elif r.estado_reporte == 'resuelto' %}
                Resuelto
              {% else %}
                {{ r.estado_reporte|default('Desconocido') }}
              {% endif %}
            </td>
            <td>{{ r.fecha_reporte.strftime('%d/%m/%Y %H:%M') if r.fecha_reporte else 'â€”' }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="16" style="text-align:center; font-style:italic; color:var(--muted);">
              No hay reportes aÃºn
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>





      
      
        
      
      <footer>
        &copy; 2025 Compuchek. Todos los derechos reservados.
      </footer>
    </main>
  </div>
</body>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const filas = document.querySelectorAll('.reporte-row');
    const form = document.getElementById('formEliminarReporte');

    filas.forEach(fila => {
      fila.addEventListener('click', () => {
        form.querySelector('#reporte_id').value = fila.dataset.id;
        form.querySelector('#edit_id_reporte').value = fila.dataset.id;
        form.querySelector('#edit_usuario').value = fila.dataset.usuario;
        form.querySelector('#edit_salon').value = fila.dataset.salon;
        form.querySelector('#edit_computadora').value = fila.dataset.computadora;
        form.querySelector('#edit_estado_reporte').value = fila.dataset.estado;
        form.querySelector('#edit_comentarios').value = fila.dataset.comentarios;
      });
    });
  });
</script>




</html>